<%- include("../partials/user/header") %>

<!-- Contact Page -->
<section class="contact-page-section">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="contact-breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item active">Contact</li>
      </ol>
    </nav>

    <!-- Contact Header -->
    <div class="contact-header">
      <div class="contact-header-content">
        <div class="audio-visualizer-contact">
          <div
            class="frequency-bar-contact"
            style="--delay: 0s; --height: 20px"
          ></div>
          <div
            class="frequency-bar-contact"
            style="--delay: 0.3s; --height: 35px"
          ></div>
          <div
            class="frequency-bar-contact"
            style="--delay: 0.6s; --height: 25px"
          ></div>
          <div
            class="frequency-bar-contact"
            style="--delay: 0.9s; --height: 40px"
          ></div>
          <div
            class="frequency-bar-contact"
            style="--delay: 1.2s; --height: 30px"
          ></div>
        </div>
        <div class="contact-header-text">
          <h1 class="contact-title">Get In Touch</h1>
          <p class="contact-subtitle">
            We're here to help you find your perfect audio experience
          </p>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Contact Form -->
      <div class="col-lg-8">
        <div class="contact-form-card floating-card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="ri-mail-send-line"></i>
              Send us a Message
            </h2>
            <p class="card-subtitle">
              Let's connect and discuss your audio journey
            </p>
          </div>

          <div class="card-body">
            <form
              id="contactForm"
              action="/contact"
              method="POST"
              class="contact-form"
            >
              <div class="form-row">
                <div class="form-group">
                  <label for="name" class="form-label">
                    <i class="ri-user-line"></i>
                    Full Name
                  </label>
                  <div class="input-wrapper">
                    <input
                      type="text"
                      class="form-input"
                      id="name"
                      name="name"
                      placeholder="Enter your full name"
                      required
                    />
                    <div class="input-focus-line"></div>
                  </div>
                  <div class="error-message" id="name-error"></div>
                </div>

                <div class="form-group">
                  <label for="email" class="form-label">
                    <i class="ri-mail-line"></i>
                    Email Address
                  </label>
                  <div class="input-wrapper">
                    <input
                      type="email"
                      class="form-input"
                      id="email"
                      name="email"
                      placeholder="Enter your email address"
                      required
                    />
                    <div class="input-focus-line"></div>
                  </div>
                  <div class="error-message" id="email-error"></div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="phone" class="form-label">
                    <i class="ri-phone-line"></i>
                    Phone Number
                  </label>
                  <div class="input-wrapper">
                    <input
                      type="tel"
                      class="form-input"
                      id="phone"
                      name="phone"
                      placeholder="+91 12345 67890"
                    />
                    <div class="input-focus-line"></div>
                  </div>
                  <div class="error-message" id="phone-error"></div>
                </div>

                <div class="form-group">
                  <label for="subject" class="form-label">
                    <i class="ri-price-tag-3-line"></i>
                    Subject
                  </label>
                  <div class="input-wrapper">
                    <select
                      class="form-input"
                      id="subject"
                      name="subject"
                      required
                    >
                      <option value="">Choose a subject...</option>
                      <option value="general">General Inquiry</option>
                      <option value="order">Order Support</option>
                      <option value="recommendation">
                        Headphone Recommendation
                      </option>
                      <option value="feedback">Feedback</option>
                      <option value="partnership">Partnership</option>
                      <option value="other">Other</option>
                    </select>
                    <div class="input-focus-line"></div>
                  </div>
                  <div class="error-message" id="subject-error"></div>
                </div>
              </div>

              <div class="form-group full-width">
                <label for="message" class="form-label">
                  <i class="ri-message-3-line"></i>
                  Message
                </label>
                <div class="input-wrapper">
                  <textarea
                    class="form-input"
                    id="message"
                    name="message"
                    rows="6"
                    placeholder="Tell us how we can help you..."
                    required
                  ></textarea>
                  <div class="input-focus-line"></div>
                </div>
                <div class="error-message" id="message-error"></div>
              </div>

              <div class="form-submit">
                <button type="submit" class="btn-submit">
                  <i class="ri-send-plane-line"></i>
                  <span>Send Message</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Contact Info Sidebar -->
      <div class="col-lg-4">
        <div class="contact-info-sidebar">
          <!-- Contact Details -->
          <div class="contact-info-card floating-card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="ri-customer-service-line"></i>
                Let's Connect
              </h3>
            </div>
            <div class="card-body">
              <p class="contact-info-desc">
                Whether you have questions about our curated collection, need
                headphone recommendations, or just want to share your audio
                journey with us.
              </p>

              <div class="contact-details">
                <div class="contact-detail-item">
                  <div class="detail-icon">
                    <i class="ri-map-pin-line"></i>
                  </div>
                  <div class="detail-content">
                    <h4 class="detail-title">Visit Our Store</h4>
                    <div class="detail-text">
                      <p>123 Audio Avenue</p>
                      <p>Tech District</p>
                      <p>Kochi, Kerala 682001</p>
                    </div>
                  </div>
                </div>

                <div class="contact-detail-item">
                  <div class="detail-icon">
                    <i class="ri-phone-line"></i>
                  </div>
                  <div class="detail-content">
                    <h4 class="detail-title">Call Us</h4>
                    <div class="detail-text">
                      <p>+91 1234567890</p>
                    </div>
                  </div>
                </div>

                <div class="contact-detail-item">
                  <div class="detail-icon">
                    <i class="ri-mail-line"></i>
                  </div>
                  <div class="detail-content">
                    <h4 class="detail-title">Email Us</h4>
                    <div class="detail-text">
                      <p>hello@phoenix.com</p>
                    </div>
                  </div>
                </div>

                <div class="contact-detail-item">
                  <div class="detail-icon">
                    <i class="ri-time-line"></i>
                  </div>
                  <div class="detail-content">
                    <h4 class="detail-title">Store Hours</h4>
                    <div class="detail-text">
                      <p>Mon - Fri: 9:00 AM - 8:00 PM</p>
                      <p>Saturday: 10:00 AM - 6:00 PM</p>
                      <p>Sunday: 11:00 AM - 5:00 PM</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Connect -->
          <div class="quick-connect-card floating-card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="ri-flashlight-line"></i>
                Quick Connect
              </h3>
            </div>
            <div class="card-body">
              <div class="quick-connect-buttons">
                <a href="tel:+911234567890" class="quick-connect-btn">
                  <i class="ri-phone-line"></i>
                  <span>Call Now</span>
                </a>
                <a href="mailto:hello@phoenix.com" class="quick-connect-btn">
                  <i class="ri-mail-line"></i>
                  <span>Email Us</span>
                </a>
                <a href="#" class="quick-connect-btn" onclick="scrollToMap()">
                  <i class="ri-map-pin-line"></i>
                  <span>Get Directions</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FAQ Section -->
<section class="faq-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Frequently Asked Questions</h2>
      <div class="title-underline"></div>
      <p class="section-subtitle">
        Quick answers to common questions about Phoenix
      </p>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="faq-accordion">
          <div class="faq-item floating-card">
            <div class="faq-question" data-faq="1">
              <div class="faq-question-content">
                <h4 class="faq-title">
                  How do you curate your headphone collection?
                </h4>
                <div class="faq-icon">
                  <i class="ri-add-line"></i>
                </div>
              </div>
            </div>
            <div class="faq-answer" id="faq-1">
              <div class="faq-answer-content">
                <p>
                  Our curation process involves a team of audio experts who
                  carefully select headphones based on quality, uniqueness, and
                  sound excellence. We focus on products that have the power to
                  deliver exceptional audio experiences for music lovers and
                  audiophiles.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-item floating-card">
            <div class="faq-question" data-faq="2">
              <div class="faq-question-content">
                <h4 class="faq-title">
                  Do you offer personalized headphone recommendations?
                </h4>
                <div class="faq-icon">
                  <i class="ri-add-line"></i>
                </div>
              </div>
            </div>
            <div class="faq-answer" id="faq-2">
              <div class="faq-answer-content">
                <p>
                  Yes! We offer personalized headphone recommendations based on
                  your music preferences, usage patterns, and budget. Contact us
                  with your requirements, and our audio experts will suggest
                  headphones that perfectly match your listening needs.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-item floating-card">
            <div class="faq-question" data-faq="3">
              <div class="faq-question-content">
                <h4 class="faq-title">
                  What are your shipping and return policies?
                </h4>
                <div class="faq-icon">
                  <i class="ri-add-line"></i>
                </div>
              </div>
            </div>
            <div class="faq-answer" id="faq-3">
              <div class="faq-answer-content">
                <p>
                  We offer free shipping on orders over ₹500 within India. All
                  headphones can be returned within 30 days of purchase in
                  original condition. We believe every headphone should find its
                  right listener, so we're happy to help with exchanges.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-item floating-card">
            <div class="faq-question" data-faq="4">
              <div class="faq-question-content">
                <h4 class="faq-title">
                  Do you host audio events or listening sessions?
                </h4>
                <div class="faq-icon">
                  <i class="ri-add-line"></i>
                </div>
              </div>
            </div>
            <div class="faq-answer" id="faq-4">
              <div class="faq-answer-content">
                <p>
                  Absolutely! We regularly host audio demonstrations, headphone
                  testing sessions, and music appreciation events. Follow our
                  newsletter and social media for updates on upcoming events
                  where music and technology connect.
                </p>
              </div>
            </div>
          </div>

          <div class="faq-item floating-card">
            <div class="faq-question" data-faq="5">
              <div class="faq-question-content">
                <h4 class="faq-title">
                  Can I sell or trade my headphones with Phoenix?
                </h4>
                <div class="faq-icon">
                  <i class="ri-add-line"></i>
                </div>
              </div>
            </div>
            <div class="faq-answer" id="faq-5">
              <div class="faq-answer-content">
                <p>
                  We have a selective headphone trade program for rare and
                  exceptional models that align with our curation philosophy.
                  Contact us with details about the headphones you'd like to
                  trade, and we'll let you know if they fit our collection.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Map Section -->
<section class="map-section" id="map-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Find Our Store</h2>
      <div class="title-underline"></div>
      <p class="section-subtitle">
        Visit us in the heart of Kochi's tech district
      </p>
    </div>

    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="map-container floating-card">
          <div class="map-wrapper">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d31445.344495741748!2d76.26496!3d9.9312!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3b080d514abec6bf%3A0xbd582caa5844192!2sKochi%2C%20Kerala%2C%20India!5e0!3m2!1sen!2sin!4v1234567890"
              width="100%"
              height="400"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            >
            </iframe>
          </div>
          <div class="map-overlay">
            <div class="map-info">
              <div class="map-info-content">
                <h4 class="map-title">Phoenix Audio Store</h4>
                <p class="map-address">
                  123 Audio Avenue, Tech District<br />Kochi, Kerala 682001
                </p>
                <div class="map-actions">
                  <a
                    href="https://maps.google.com"
                    target="_blank"
                    class="map-btn"
                  >
                    <i class="ri-direction-line"></i>
                    Get Directions
                  </a>
                  <a href="tel:+911234567890" class="map-btn">
                    <i class="ri-phone-line"></i>
                    Call Store
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include("../partials/user/footer") %>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize contact form
    initializeContactForm();

    // Initialize FAQ accordion
    initializeFAQ();
  });

  function initializeContactForm() {
    const contactForm = document.getElementById("contactForm");

    // Function to clear all error messages
    function clearErrors() {
      const errorMessages = contactForm.querySelectorAll(".error-message");
      const inputs = contactForm.querySelectorAll(".form-input");

      errorMessages.forEach((error) => {
        error.classList.remove("show");
        error.textContent = "";
      });

      inputs.forEach((input) => {
        input.classList.remove("error");
      });
    }

    // Function to show specific field error
    function showFieldError(fieldName, message) {
      const field = contactForm.querySelector(`[name="${fieldName}"]`);
      const errorElement = contactForm.querySelector(`#${fieldName}-error`);

      if (field && errorElement) {
        field.classList.add("error");
        errorElement.textContent = message;
        errorElement.classList.add("show");

        // Scroll to first error (only if this is the first error being shown)
        const existingErrors = contactForm.querySelectorAll(
          ".error-message.show"
        );
        if (existingErrors.length === 1) {
          setTimeout(() => {
            field.scrollIntoView({ behavior: "smooth", block: "center" });
          }, 100);
        }
      }
    }

    // Function to map server errors to specific fields
    function displayValidationErrors(errors) {
      clearErrors();

      errors.forEach((error) => {
        const errorLower = error.toLowerCase();

        if (errorLower.includes("name")) {
          showFieldError("name", error);
        } else if (errorLower.includes("email")) {
          showFieldError("email", error);
        } else if (errorLower.includes("phone")) {
          showFieldError("phone", error);
        } else if (errorLower.includes("subject")) {
          showFieldError("subject", error);
        } else if (errorLower.includes("message")) {
          showFieldError("message", error);
        } else {
          // For general errors, show in a toast
          showNotification("error", error);
        }
      });
    }

    contactForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      // Clear previous errors
      clearErrors();

      const formData = new FormData(contactForm);
      const data = Object.fromEntries(formData);

      try {
        // Show loading state
        const submitBtn = contactForm.querySelector(".btn-submit");
        const originalContent = submitBtn.innerHTML;
        submitBtn.innerHTML =
          '<i class="ri-loader-4-line spin"></i><span>Sending...</span>';
        submitBtn.disabled = true;

        // Make actual API request
        const response = await fetch("/contact", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.success) {
          // Show success message
          showNotification(
            "success",
            result.message ||
              "Thank you for reaching out. We'll get back to you within 24 hours."
          );

          // Reset form and clear errors
          contactForm.reset();
          clearErrors();
        } else {
          // Handle validation errors
          if (result.errors && Array.isArray(result.errors)) {
            displayValidationErrors(result.errors);
          } else {
            // Show general error message
            showNotification(
              "error",
              result.message || "Something went wrong. Please try again."
            );
          }
        }

        // Reset button
        submitBtn.innerHTML = originalContent;
        submitBtn.disabled = false;
      } catch (error) {
        console.error("Contact form error:", error);
        // Show error message
        showNotification(
          "error",
          "Something went wrong. Please try again later."
        );

        // Reset button
        const submitBtn = contactForm.querySelector(".btn-submit");
        submitBtn.innerHTML =
          '<i class="ri-send-plane-line"></i><span>Send Message</span>';
        submitBtn.disabled = false;
      }
    });

    // Clear errors when user starts typing
    const inputs = contactForm.querySelectorAll(".form-input");
    inputs.forEach((input) => {
      input.addEventListener("input", function () {
        if (this.classList.contains("error")) {
          this.classList.remove("error");
          const errorElement = contactForm.querySelector(`#${this.name}-error`);
          if (errorElement) {
            errorElement.classList.remove("show");
            errorElement.textContent = "";
          }
        }
      });

      // Add focus effects
      input.addEventListener("focus", function () {
        this.parentElement.classList.add("focused");
      });

      input.addEventListener("blur", function () {
        this.parentElement.classList.remove("focused");
      });
    });
  }

  function initializeFAQ() {
    const faqQuestions = document.querySelectorAll(".faq-question");

    faqQuestions.forEach((question) => {
      question.addEventListener("click", function () {
        const faqNumber = this.dataset.faq;
        const answer = document.getElementById(`faq-${faqNumber}`);
        const icon = this.querySelector(".faq-icon i");
        const faqItem = this.closest(".faq-item");

        // Close all other FAQ items
        faqQuestions.forEach((otherQuestion) => {
          if (otherQuestion !== this) {
            const otherFaqNumber = otherQuestion.dataset.faq;
            const otherAnswer = document.getElementById(
              `faq-${otherFaqNumber}`
            );
            const otherIcon = otherQuestion.querySelector(".faq-icon i");
            const otherFaqItem = otherQuestion.closest(".faq-item");

            otherAnswer.classList.remove("open");
            otherIcon.className = "ri-add-line";
            otherFaqItem.classList.remove("active");
          }
        });

        // Toggle current FAQ item
        if (answer.classList.contains("open")) {
          answer.classList.remove("open");
          icon.className = "ri-add-line";
          faqItem.classList.remove("active");
        } else {
          answer.classList.add("open");
          icon.className = "ri-subtract-line";
          faqItem.classList.add("active");
        }
      });
    });
  }

  function scrollToMap() {
    document.getElementById("map-section").scrollIntoView({
      behavior: "smooth",
      block: "start",
    });
  }

  function showNotification(type, message) {
    Swal.fire({
      toast: true,
      position: "top-end",
      icon: type,
      title: message,
      showConfirmButton: false,
      timer: 4000,
      background: "#fff",
      color: "#1B3C53",
    });
  }
</script>
