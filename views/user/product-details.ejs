<%- include("../partials/user/header") %>

<!-- Hero Section with Sound Wave Animation -->
<section class="hero-section">
  <div class="sound-waves">
    <div class="wave wave-1"></div>
    <div class="wave wave-2"></div>
    <div class="wave wave-3"></div>
  </div>
  <div class="container">
    <div class="hero-content">
      <div class="hero-badge">PREMIUM AUDIO EXPERIENCE</div>
      <h1 class="hero-title">Discover Sound That Moves You</h1>
      <p class="hero-subtitle">
        Experience crystal-clear audio with our curated collection of premium
        headphones
      </p>
      <div class="hero-buttons">
        <a href="/shopPage" class="btn-primary-glow">
          <span>Explore Collections</span>
          <div class="btn-glow"></div>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Featured Categories -->
<section class="categories-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Browse Categories</h2>
      <a href="/shopPage" class="view-all-link">
        View All
        <i class="ri-arrow-right-line"></i>
      </a>
    </div>
    <div class="categories-grid">
      <% if (categories && categories.length > 0) { %> <% categories.slice(0,
      3).forEach((category, index) => { %>
      <div
        class="category-card floating-card"
        data-aos="fade-up"
        data-aos-delay="<%= index * 100 %>"
      >
        <div class="category-image">
          <img src="<%= category.image %>" alt="<%= category.name %>" />
          <div class="category-overlay">
            <div class="sound-indicator">
              <span class="sound-bar"></span>
              <span class="sound-bar"></span>
              <span class="sound-bar"></span>
            </div>
          </div>
        </div>
        <div class="category-content">
          <h3 class="category-name"><%= category.name %></h3>
          <a
            href="/shopPage?category=<%= category._id %>"
            class="category-link"
          >
            Explore Collection
            <i class="ri-headphone-line"></i>
          </a>
        </div>
      </div>
      <% }) %> <% } else { %>
      <div class="empty-state">
        <i class="ri-headphone-line"></i>
        <p>No categories available at the moment.</p>
      </div>
      <% } %>
    </div>
  </div>
</section>

<!-- New Arrivals -->
<section class="products-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">New Arrivals</h2>
      <a href="/shopPage" class="view-all-link">
        View All
        <i class="ri-arrow-right-line"></i>
      </a>
    </div>
    <div class="products-grid">
      <% if (newArrivals && newArrivals.length > 0) { %> <% newArrivals.slice(0,
      4).forEach((product, index) => { %>
      <div
        class="product-card floating-card"
        data-aos="fade-up"
        data-aos-delay="<%= index * 100 %>"
      >
        <div class="product-image-wrapper">
          <% if (product.isNew) { %>
          <span class="product-badge new-badge">New</span>
          <% } %> <% if (product.activeOffer) { %>
          <span class="product-badge offer-badge">
            <%= Math.round(product.discountPercentage) %>% OFF
          </span>
          <% } %>
          <a href="/products/<%= product._id %>" class="product-image-link">
            <img
              src="<%= product.mainImage || '/api/placeholder/600/800' %>"
              alt="<%= product.model %>"
              class="product-image"
            />
            <div class="product-overlay">
              <div class="quick-view">Quick View</div>
            </div>
          </a>
        </div>
        <div class="product-info">
          <div class="product-brand"><%= product.brand %></div>
          <h3 class="product-title">
            <a href="/products/<%= product._id %>"><%= product.model %></a>
          </h3>
          <div class="product-price">
            <% if (product.activeOffer) { %>
            <div class="price-group">
              <span class="current-price"
                >₹<%= product.finalPrice.toFixed(2) %></span
              >
              <span class="original-price"
                >₹<%= product.regularPrice.toFixed(2) %></span
              >
            </div>
            <div class="offer-text"><%= product.activeOffer.title %></div>
            <% } else { %>
            <span class="current-price"
              >₹<%= product.regularPrice.toFixed(2) %></span
            >
            <% } %>
          </div>
          <div class="product-actions">
            <button class="btn-wishlist" data-product-id="<%= product._id %>">
              <i class="ri-heart-line"></i>
            </button>
            <button
              class="btn-add-cart add-to-cart"
              data-product-id="<%= product._id %>"
            >
              <i class="ri-shopping-cart-line"></i>
              <span>Add to Cart</span>
            </button>
          </div>
        </div>
      </div>
      <% }) %> <% } else { %>
      <div class="empty-state">
        <i class="ri-headphone-line"></i>
        <p>No new arrivals available at the moment.</p>
      </div>
      <% } %>
    </div>
  </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section">
  <div class="container">
    <div class="newsletter-content">
      <div class="sound-wave-bg">
        <div class="wave-line wave-line-1"></div>
        <div class="wave-line wave-line-2"></div>
        <div class="wave-line wave-line-3"></div>
      </div>
      <h2 class="newsletter-title">Join Our Audio Journey</h2>
      <p class="newsletter-subtitle">
        Subscribe to receive curated headphone recommendations, brand
        spotlights, and exclusive offers.
      </p>
      <form class="newsletter-form">
        <div class="input-group">
          <input
            type="email"
            class="newsletter-input"
            placeholder="Enter your email address"
          />
          <button type="submit" class="btn-subscribe">
            <span>Subscribe</span>
            <i class="ri-send-plane-line"></i>
          </button>
        </div>
      </form>
      <p class="newsletter-privacy">
        By subscribing, you agree to our Privacy Policy and consent to receive
        updates from Phoenix.
      </p>
    </div>
  </div>
</section>

<%- include("../partials/user/footer") %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize AOS (Add this library to your project)
    if (typeof AOS !== "undefined") {
      AOS.init({
        duration: 800,
        once: true,
        offset: 100,
      });
    }

    // Cart and Wishlist functionality (keeping your existing logic)
    const cartCountElement = document.querySelector(".cart-count");
    const wishlistCountElement = document.querySelector(".wishlist-count");

    // Add to cart functionality
    document.querySelectorAll(".add-to-cart").forEach((button) => {
      button.addEventListener("click", async function () {
        const productId = this.dataset.productId;

        try {
          const response = await fetch("/api/cart/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId, quantity: 1 }),
          });

          const result = await response.json();

          if (response.status === 401 || !result.success) {
            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "error",
              title:
                result.message || "Please log in to add items to your cart",
              showConfirmButton: false,
              timer: 2000,
            }).then(() => {
              window.location.href = "/login";
            });
          } else if (result.success) {
            if (cartCountElement) {
              cartCountElement.textContent = result.cartCount;
              cartCountElement.dataset.count = result.cartCount;
            }

            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "success",
              title: result.message,
              showConfirmButton: false,
              timer: 1500,
            });
          } else {
            if (
              result.message === "Please log in to add items to your cart" ||
              result.requiresAuth
            ) {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 2000,
              }).then(() => {
                window.location.href = "/login";
              });
            } else {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 1500,
              });
            }
          }
        } catch (error) {
          Swal.fire({
            toast: true,
            position: "top-end",
            icon: "error",
            title: "Error adding to cart",
            showConfirmButton: false,
            timer: 1500,
          });
        }
      });
    });

    // Wishlist functionality
    document.querySelectorAll(".btn-wishlist").forEach((button) => {
      button.addEventListener("click", async function () {
        const productId = this.dataset.productId;

        try {
          const response = await fetch("/api/wishlist/toggle", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId }),
          });

          const result = await response.json();

          if (response.status === 401 || !result.success) {
            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "error",
              title: result.message || "Please log in to manage your wishlist",
              showConfirmButton: false,
              timer: 2000,
            }).then(() => {
              window.location.href = "/login";
            });
          } else if (result.success) {
            const icon = this.querySelector("i");
            if (result.isWishlisted) {
              icon.className = "ri-heart-fill";
              this.classList.add("wishlisted");
            } else {
              icon.className = "ri-heart-line";
              this.classList.remove("wishlisted");
            }

            if (wishlistCountElement) {
              wishlistCountElement.textContent = result.wishlistCount;
              wishlistCountElement.dataset.count = result.wishlistCount;
            }

            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "success",
              title: result.message,
              showConfirmButton: false,
              timer: 1500,
            });
          } else {
            if (
              result.message === "Please log in to manage your wishlist" ||
              result.requiresAuth
            ) {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 2000,
              }).then(() => {
                window.location.href = "/login";
              });
            } else {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 1500,
              });
            }
          }
        } catch (error) {
          Swal.fire({
            toast: true,
            position: "top-end",
            icon: "error",
            title: "Error managing wishlist",
            showConfirmButton: false,
            timer: 1500,
          });
        }
      });
    });
  });
</script>
