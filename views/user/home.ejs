<%- include("../partials/user/header") %>

<!-- Hero Section without Color Mask -->
<section class="hero-section">
  <div class="audio-visualizer">
    <div class="frequency-bar" style="--delay: 0s; --height: 20px"></div>
    <div class="frequency-bar" style="--delay: 0.1s; --height: 35px"></div>
    <div class="frequency-bar" style="--delay: 0.2s; --height: 25px"></div>
    <div class="frequency-bar" style="--delay: 0.3s; --height: 40px"></div>
    <div class="frequency-bar" style="--delay: 0.4s; --height: 15px"></div>
    <div class="frequency-bar" style="--delay: 0.5s; --height: 30px"></div>
    <div class="frequency-bar" style="--delay: 0.6s; --height: 45px"></div>
    <div class="frequency-bar" style="--delay: 0.7s; --height: 25px"></div>
    <div class="frequency-bar" style="--delay: 0.8s; --height: 35px"></div>
    <div class="frequency-bar" style="--delay: 0.9s; --height: 20px"></div>
  </div>
  <div class="container">
    <div class="hero-content">
      <div class="hero-badge">PREMIUM AUDIO EXPERIENCE</div>
      <h1 class="hero-title">Discover Sound That Moves You</h1>
      <p class="hero-subtitle">
        Experience crystal-clear audio with our curated collection of premium
        headphones
      </p>
      <div class="hero-buttons">
        <a href="/shopPage" class="btn-premium">
          <span class="btn-text">Explore Collections</span>
          <div class="btn-bg"></div>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Featured Categories (All in One Line) -->
<section class="categories-section">
  <div class="container">
    <div class="section-header">
      <div class="section-title-group">
        <h2 class="section-title">Browse Categories</h2>
        <div class="title-underline"></div>
      </div>
    </div>
    <div class="categories-container">
      <div class="categories-grid">
        <% if (categories && categories.length > 0) { %> <%
        categories.forEach((category, index) => { %>
        <div
          class="category-card floating-card"
          data-aos="fade-up"
          data-aos-delay="<%= index * 100 %>"
        >
          <div class="category-image">
            <img src="<%= category.image %>" alt="<%= category.name %>" />
            <div class="category-overlay">
              <div class="sound-pulse">
                <div class="pulse-ring"></div>
                <div class="pulse-ring"></div>
                <div class="pulse-ring"></div>
              </div>
            </div>
          </div>
          <div class="category-content">
            <h3 class="category-name"><%= category.name %></h3>
            <a
              href="/shopPage?category=<%= category._id %>"
              class="category-link"
            >
              Explore Collection
              <i class="ri-headphone-line"></i>
            </a>
          </div>
        </div>
        <% }) %> <% } else { %>
        <div class="empty-state">
          <i class="ri-headphone-line"></i>
          <p>No categories available at the moment.</p>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</section>

<!-- New Arrivals (4 Cards Fixed) -->
<section class="products-section">
  <div class="container">
    <div class="section-header">
      <div class="section-title-group">
        <h2 class="section-title">New Arrivals</h2>
        <div class="title-underline"></div>
      </div>
    </div>
    <div class="products-grid-fixed">
      <% if (newArrivals && newArrivals.length > 0) { %> <% newArrivals.slice(0,
      4).forEach((product, index) => { %>
      <div
        class="product-card floating-card"
        data-aos="fade-up"
        data-aos-delay="<%= index * 100 %>"
      >
        <div class="product-image-wrapper">
          <% if (product.isNew) { %>
          <span class="product-badge new-badge">New</span>
          <% } %> <% if (product.activeOffer) { %>
          <span class="product-badge offer-badge">
            <%= Math.round(product.discountPercentage) %>% OFF
          </span>
          <% } %>
          <a href="/products/<%= product._id %>" class="product-image-link">
            <img
              src="<%= product.mainImage || '/api/placeholder/600/800' %>"
              alt="<%= product.model %>"
              class="product-image"
            />
            <div class="product-overlay">
              <div class="quick-view-btn">Quick View</div>
            </div>
          </a>
        </div>
        <div class="product-info">
          <div class="product-brand"><%= product.brand %></div>
          <h3 class="product-title">
            <a href="/products/<%= product._id %>"><%= product.model %></a>
          </h3>
          <div class="product-price">
            <% if (product.activeOffer) { %>
            <div class="price-group">
              <span class="current-price"
                >₹<%= product.finalPrice.toFixed(2) %></span
              >
              <span class="original-price"
                >₹<%= product.regularPrice.toFixed(2) %></span
              >
            </div>
            <div class="offer-text"><%= product.activeOffer.title %></div>
            <% } else { %>
            <span class="current-price"
              >₹<%= product.regularPrice.toFixed(2) %></span
            >
            <% } %>
          </div>
          <div class="product-actions">
            <button class="btn-wishlist" data-product-id="<%= product._id %>">
              <i class="ri-heart-line"></i>
            </button>
            <button
              class="btn-add-cart-rect add-to-cart"
              data-product-id="<%= product._id %>"
            >
              <i class="ri-shopping-cart-line"></i>
              <span>Add to Cart</span>
            </button>
          </div>
        </div>
      </div>
      <% }) %> <% } else { %>
      <div class="empty-state">
        <i class="ri-headphone-line"></i>
        <p>No new arrivals available at the moment.</p>
      </div>
      <% } %>
    </div>
  </div>
</section>

<!-- Enhanced Music Player Section -->
<section class="music-player-section">
  <div class="container">
    <div class="music-player-content">
      <h2 class="player-title">Feel the Beat</h2>
      <div class="music-player-interface">
        <div class="player-left">
          <div class="track-info">
            <div class="track-title">Premium Sound Experience</div>
            <div class="track-artist">Phoenix Audio</div>
          </div>
          <div class="player-controls">
            <button class="control-btn prev-track">
              <i class="ri-skip-back-line"></i>
            </button>
            <button class="control-btn play-btn-main">
              <i class="ri-play-fill"></i>
            </button>
            <button class="control-btn next-track">
              <i class="ri-skip-forward-line"></i>
            </button>
          </div>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill"></div>
            </div>
            <div class="time-display">
              <span class="current-time">1:23</span>
              <span class="total-time">3:45</span>
            </div>
          </div>
        </div>
        <div class="player-right">
          <div class="equalizer">
            <div class="eq-bar" style="--delay: 0s"></div>
            <div class="eq-bar" style="--delay: 0.1s"></div>
            <div class="eq-bar" style="--delay: 0.2s"></div>
            <div class="eq-bar" style="--delay: 0.3s"></div>
            <div class="eq-bar" style="--delay: 0.4s"></div>
            <div class="eq-bar" style="--delay: 0.5s"></div>
            <div class="eq-bar" style="--delay: 0.6s"></div>
            <div class="eq-bar" style="--delay: 0.7s"></div>
            <div class="eq-bar" style="--delay: 0.8s"></div>
            <div class="eq-bar" style="--delay: 0.9s"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Simple Newsletter Section -->
<section class="newsletter-section">
  <div class="container">
    <div class="newsletter-content">
      <h3 class="newsletter-title">Stay Updated</h3>
      <p class="newsletter-text">
        Get the latest headphone releases and exclusive offers
      </p>
      <form class="newsletter-form">
        <input
          type="email"
          class="newsletter-input"
          placeholder="Your email address"
        />
        <button type="submit" class="newsletter-btn">Subscribe</button>
      </form>
    </div>
  </div>
</section>

<%- include("../partials/user/footer") %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize AOS
    if (typeof AOS !== "undefined") {
      AOS.init({
        duration: 800,
        once: true,
        offset: 100,
      });
    }

    // Music player animation
    const playBtnMain = document.querySelector(".play-btn-main");
    const eqBars = document.querySelectorAll(".eq-bar");
    const progressFill = document.querySelector(".progress-fill");
    let isPlaying = false;
    let progressInterval;

    if (playBtnMain) {
      playBtnMain.addEventListener("click", () => {
        isPlaying = !isPlaying;
        const icon = playBtnMain.querySelector("i");

        if (isPlaying) {
          icon.className = "ri-pause-fill";
          eqBars.forEach((bar) => bar.classList.add("playing"));
          startProgress();
        } else {
          icon.className = "ri-play-fill";
          eqBars.forEach((bar) => bar.classList.remove("playing"));
          stopProgress();
        }
      });
    }

    function startProgress() {
      let progress = 0;
      progressInterval = setInterval(() => {
        progress += 0.5;
        if (progress >= 100) {
          progress = 0;
        }
        if (progressFill) {
          progressFill.style.width = progress + "%";
        }
      }, 100);
    }

    function stopProgress() {
      if (progressInterval) {
        clearInterval(progressInterval);
      }
    }

    // Cart and Wishlist functionality
    const cartCountElement = document.querySelector(".cart-count");
    const wishlistCountElement = document.querySelector(".wishlist-count");

    // Add to cart functionality
    document.querySelectorAll(".add-to-cart").forEach((button) => {
      button.addEventListener("click", async function () {
        const productId = this.dataset.productId;

        try {
          const response = await fetch("/api/cart/add", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId, quantity: 1 }),
          });

          const result = await response.json();

          if (response.status === 401 || !result.success) {
            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "error",
              title:
                result.message || "Please log in to add items to your cart",
              showConfirmButton: false,
              timer: 2000,
            }).then(() => {
              window.location.href = "/login";
            });
          } else if (result.success) {
            if (cartCountElement) {
              cartCountElement.textContent = result.cartCount;
              cartCountElement.dataset.count = result.cartCount;
            }

            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "success",
              title: result.message,
              showConfirmButton: false,
              timer: 1500,
            });
          } else {
            if (
              result.message === "Please log in to add items to your cart" ||
              result.requiresAuth
            ) {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 2000,
              }).then(() => {
                window.location.href = "/login";
              });
            } else {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 1500,
              });
            }
          }
        } catch (error) {
          Swal.fire({
            toast: true,
            position: "top-end",
            icon: "error",
            title: "Error adding to cart",
            showConfirmButton: false,
            timer: 1500,
          });
        }
      });
    });

    // Wishlist functionality
    document.querySelectorAll(".btn-wishlist").forEach((button) => {
      button.addEventListener("click", async function () {
        const productId = this.dataset.productId;

        try {
          const response = await fetch("/api/wishlist/toggle", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ productId }),
          });

          const result = await response.json();

          if (response.status === 401 || !result.success) {
            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "error",
              title: result.message || "Please log in to manage your wishlist",
              showConfirmButton: false,
              timer: 2000,
            }).then(() => {
              window.location.href = "/login";
            });
          } else if (result.success) {
            const icon = this.querySelector("i");
            if (result.isWishlisted) {
              icon.className = "ri-heart-fill";
              this.classList.add("wishlisted");
            } else {
              icon.className = "ri-heart-line";
              this.classList.remove("wishlisted");
            }

            if (wishlistCountElement) {
              wishlistCountElement.textContent = result.wishlistCount;
              wishlistCountElement.dataset.count = result.wishlistCount;
            }

            Swal.fire({
              toast: true,
              position: "top-end",
              icon: "success",
              title: result.message,
              showConfirmButton: false,
              timer: 1500,
            });
          } else {
            if (
              result.message === "Please log in to manage your wishlist" ||
              result.requiresAuth
            ) {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 2000,
              }).then(() => {
                window.location.href = "/login";
              });
            } else {
              Swal.fire({
                toast: true,
                position: "top-end",
                icon: "error",
                title: result.message,
                showConfirmButton: false,
                timer: 1500,
              });
            }
          }
        } catch (error) {
          Swal.fire({
            toast: true,
            position: "top-end",
            icon: "error",
            title: "Error managing wishlist",
            showConfirmButton: false,
            timer: 1500,
          });
        }
      });
    });
  });
</script>
