<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phoenix - Premium Headphone Experience</title>

    <!-- Font imports for the new typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Audiowide:wght@400&family=Raleway:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <!-- SweetAlert2 CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <link rel="stylesheet" href="/styles/user/landingPageStyle.css" />
    <link rel="stylesheet" href="/styles/user/productDetails.css" />
    <link rel="stylesheet" href="/styles/user/shop-page.css" />
    <link rel="stylesheet" href="/styles/user/contacts.css" />
    <link rel="stylesheet" href="/styles/user/navbar-fix.css" />
    <link rel="stylesheet" href="/styles/user/responsive-utilities.css" />
    <link rel="stylesheet" href="/styles/global-alignment-fixes.css" />

    <!-- Date Validation Scripts -->
    <script src="/js/dateValidation.js"></script>
    <script src="/js/dateValidationHelper.js"></script>

    <style>
      /* Root variables for consistent color scheme */
      :root {
        --primary-color: #1b3c53; /* Deep blue-gray (primary) */
        --secondary-color: #456882; /* Medium blue-gray (secondary) */
        --accent-beige: #d2c1b6; /* Light beige (secondary) */
        --accent-cream: #f9f3ef; /* Off-white/cream (secondary) */
        --supporting-white: #ffffff; /* Pure white for contrast */
        --text-dark: #2d3748; /* Dark text color */
        --error-red: #d63031; /* Error red */
        --success-green: #00b894; /* Success green */

        /* Gradients */
        --gradient-primary: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        --gradient-secondary: linear-gradient(
          135deg,
          var(--secondary-color),
          var(--accent-beige)
        );
        --gradient-navbar: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );

        /* Shadows */
        --shadow-navbar: 0 4px 15px rgba(27, 60, 83, 0.3);
        --shadow-dropdown: 0 8px 25px rgba(27, 60, 83, 0.4);

        /* Typography */
        --font-heading: "Audiowide", cursive;
        --font-body: "Raleway", sans-serif;
        --font-feature: "Montserrat", sans-serif;
      }

      /* Elegant Navigation Bar Theme */
      .navbar-elegant-theme {
        background: var(--gradient-navbar) !important;
        border-bottom: 2px solid rgba(210, 193, 182, 0.3);
        box-shadow: var(--shadow-navbar);
        backdrop-filter: blur(10px);
        font-family: var(--font-body);
        padding: 0.5rem 0;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        z-index: 1030 !important;
      }

      /* Fixed container layout for proper alignment */
      .navbar-elegant-theme .container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: nowrap;
        padding-left: 2rem;
        padding-right: 2rem;
        max-width: 100%;
      }

      /* Enhanced responsive container padding */
      @media (max-width: 1399px) {
        .navbar-elegant-theme .container {
          padding-left: 1.5rem;
          padding-right: 1.5rem;
        }
      }

      @media (max-width: 1199px) {
        .navbar-elegant-theme .container {
          padding-left: 1rem;
          padding-right: 1rem;
        }
      }

      @media (max-width: 991px) {
        .navbar-elegant-theme .container {
          padding-left: 0.75rem;
          padding-right: 0.75rem;
        }
      }

      @media (max-width: 767px) {
        .navbar-elegant-theme .container {
          padding-left: 0.5rem;
          padding-right: 0.5rem;
        }
      }

      /* Brand Section - Compact */
      .navbar-brand-section {
        flex: 0 0 auto;
        min-width: auto;
      }

      .navbar-elegant-theme .navbar-brand {
        color: var(--supporting-white) !important;
        font-family: var(--font-heading);
        font-size: 1.5rem !important;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        margin-right: 0;
        white-space: nowrap;
      }

      .navbar-elegant-theme .navbar-brand img {
        height: 32px;
        width: auto;
        filter: drop-shadow(0 2px 8px rgba(249, 243, 239, 0.3));
        transition: all 0.3s ease;
      }

      .navbar-elegant-theme .navbar-brand:hover {
        color: var(--accent-cream) !important;
        text-shadow: 0 0 15px rgba(249, 243, 239, 0.6);
        transform: scale(1.02);
      }

      .navbar-elegant-theme .navbar-brand:hover img {
        filter: drop-shadow(0 4px 12px rgba(249, 243, 239, 0.5));
        transform: scale(1.05);
      }

      /* Enhanced Mobile Toggler */
      .navbar-elegant-theme .navbar-toggler {
        border: 2px solid rgba(249, 243, 239, 0.3);
        color: var(--supporting-white);
        border-radius: 12px;
        padding: 0.75rem;
        transition: all 0.3s ease;
        order: 3;
        min-width: 48px;
        min-height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        background: rgba(249, 243, 239, 0.1);
        backdrop-filter: blur(10px);
      }

      .navbar-elegant-theme .navbar-toggler:focus {
        box-shadow: 0 0 0 0.25rem rgba(249, 243, 239, 0.4);
        border-color: var(--accent-cream);
        outline: none;
      }

      .navbar-elegant-theme .navbar-toggler:hover {
        border-color: var(--accent-cream);
        background: rgba(249, 243, 239, 0.2);
        transform: scale(1.05);
      }

      .navbar-elegant-theme .navbar-toggler:active {
        transform: scale(0.95);
      }

      /* Animated hamburger icon */
      .navbar-elegant-theme .navbar-toggler i {
        color: var(--supporting-white);
        font-size: 1.4rem;
        transition: all 0.3s ease;
      }

      .navbar-elegant-theme .navbar-toggler[aria-expanded="true"] i {
        transform: rotate(90deg);
      }

      /* Enhanced touch target for mobile */
      @media (max-width: 991px) {
        .navbar-elegant-theme .navbar-toggler {
          min-width: 52px;
          min-height: 52px;
          padding: 0.875rem;
        }
      }

      /* Desktop Search Bar Styles */
      .desktop-search-container {
        position: relative;
        margin: 0 1.5rem;
        flex-shrink: 0;
      }

      .search-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 25px;
        padding: 0;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        width: 280px;
        height: 42px;
      }

      .search-input-wrapper:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .search-input-wrapper:focus-within {
        background: rgba(255, 255, 255, 0.25);
        border-color: var(--accent-cream);
        box-shadow: 0 0 0 3px rgba(210, 193, 182, 0.3);
      }

      .search-input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        padding: 0.6rem 1rem 0.6rem 2.8rem;
        color: var(--supporting-white);
        font-size: 0.9rem;
        font-weight: 400;
        font-family: var(--font-body);
        width: 100%;
      }

      .search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
        font-weight: 300;
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
        pointer-events: none;
        z-index: 2;
      }

      .clear-search-btn {
        position: absolute;
        right: 0.5rem;
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.7);
        font-size: 1rem;
        padding: 0.4rem;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0;
        visibility: hidden;
        transform: scale(0.8);
        z-index: 2;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .clear-search-btn.show {
        opacity: 1;
        visibility: visible;
        transform: scale(1);
      }

      .clear-search-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: var(--supporting-white);
        transform: scale(1.1);
      }

      .clear-search-btn:active {
        transform: scale(0.95);
      }

      /* Search Results Dropdown */
      .search-results-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--supporting-white);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(27, 60, 83, 0.1);
        max-height: 400px;
        overflow-y: auto;
        z-index: 1050;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        margin-top: 0.5rem;
      }

      .search-results-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .search-result-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid rgba(27, 60, 83, 0.08);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        color: var(--text-dark);
      }

      .search-result-item:hover {
        background: rgba(27, 60, 83, 0.05);
        text-decoration: none;
        color: var(--primary-color);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      .search-result-image {
        width: 48px;
        height: 48px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 0.75rem;
        flex-shrink: 0;
      }

      .search-result-content {
        flex: 1;
        min-width: 0;
      }

      .search-result-title {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--text-dark);
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .search-result-brand {
        font-size: 0.8rem;
        color: var(--text-light);
        font-weight: 400;
      }

      .search-loading {
        padding: 1rem;
        text-align: center;
        color: var(--text-light);
        font-size: 0.9rem;
      }

      .search-no-results {
        padding: 1rem;
        text-align: center;
        color: var(--text-light);
        font-size: 0.9rem;
      }

      .search-error {
        padding: 1rem;
        text-align: center;
        color: #dc3545;
        font-size: 0.9rem;
      }

      /* Screen reader only content */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Responsive Design for Desktop Search */
      @media (max-width: 1200px) {
        .search-input-wrapper {
          width: 240px;
        }
      }

      @media (max-width: 1024px) {
        .desktop-search-container {
          margin: 0 1rem;
        }

        .search-input-wrapper {
          width: 220px;
        }
      }

      /* Hide desktop search on mobile and tablet */
      @media (max-width: 991.98px) {
        .desktop-search-container {
          display: none;
        }
      }

      /* Large desktop optimization */
      @media (min-width: 1441px) {
        .search-input-wrapper {
          width: 320px;
        }
      }

      /* Ultra-wide display optimization */
      @media (min-width: 1921px) {
        .desktop-search-container {
          margin: 0 2rem;
        }

        .search-input-wrapper {
          width: 360px;
        }
      }

      /* Additional responsive optimizations */
      @media (max-width: 1366px) {
        .search-input-wrapper {
          width: 200px;
        }

        .search-input {
          font-size: 0.85rem;
        }
      }

      /* Tablet landscape optimization */
      @media (min-width: 768px) and (max-width: 1024px) {
        .desktop-search-container {
          margin: 0 0.75rem;
        }
      }

      /* High DPI display optimization */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .search-result-image {
          image-rendering: -webkit-optimize-contrast;
        }
      }

      /* Reduced motion preference */
      @media (prefers-reduced-motion: reduce) {
        .search-input-wrapper,
        .clear-search-btn,
        .search-results-dropdown,
        .search-result-item {
          transition: none;
        }
      }

      /* Dark mode support (if implemented) */
      @media (prefers-color-scheme: dark) {
        .search-results-dropdown {
          background: #1a1a1a;
          border-color: rgba(255, 255, 255, 0.1);
        }

        .search-result-item {
          color: #ffffff;
          border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .search-result-item:hover {
          background: rgba(255, 255, 255, 0.1);
        }

        .search-result-title {
          color: #ffffff;
        }

        .search-result-brand {
          color: #cccccc;
        }
      }

      /* Center Navigation Links */
      .navbar-nav-center {
        flex: 1 1 auto;
        display: flex;
        justify-content: center;
      }

      .navbar-elegant-theme .navbar-nav {
        align-items: center;
      }

      /* Navigation Links */
      .navbar-elegant-theme .nav-link {
        color: rgba(249, 243, 239, 0.9) !important;
        font-family: var(--font-feature);
        font-weight: 500;
        font-size: 0.95rem;
        padding: 0.6rem 0.8rem !important;
        border-radius: 8px;
        margin: 0 0.25rem;
        transition: all 0.3s ease;
        position: relative;
        white-space: nowrap;
      }

      .navbar-elegant-theme .nav-link::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--accent-cream);
        transition: all 0.3s ease;
        transform: translateX(-50%);
        border-radius: 2px;
      }

      .navbar-elegant-theme .nav-link:hover {
        color: var(--supporting-white) !important;
        background: rgba(249, 243, 239, 0.1);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        transform: translateY(-2px);
      }

      .navbar-elegant-theme .nav-link:hover::before {
        width: 70%;
      }

      /* Active page indicator */
      .navbar-elegant-theme .nav-link.active {
        color: var(--supporting-white) !important;
        font-weight: 600 !important;
        background: rgba(249, 243, 239, 0.15);
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      }

      .navbar-elegant-theme .nav-link.active::before {
        width: 70%;
        background: var(--accent-cream);
        box-shadow: 0 0 8px rgba(249, 243, 239, 0.6);
      }

      /* Right Section - Search + Icons */
      .navbar-right-section {
        flex: 0 0 auto;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        min-width: auto;
        justify-content: flex-end;
      }

      /* Enhanced Search Input */
      .search-input {
        position: relative;
        flex-shrink: 0;
      }

      .search-icon {
        position: absolute;
        top: 50%;
        left: 1rem;
        transform: translateY(-50%);
        color: var(--secondary-color);
        z-index: 2;
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .search-input input {
        width: 180px;
        background: #ffffff;
        border: 1px solid rgba(210, 193, 182, 0.8);
        color: var(--text-dark);
        font-family: var(--font-body);
        border-radius: 8px;
        padding: 0.6rem 2.5rem 0.6rem 2.5rem;
        transition: all 0.3s ease;
        min-height: 40px;
        font-size: 0.9rem;
      }

      .search-input input::placeholder {
        color: rgba(69, 104, 130, 0.7);
        font-family: var(--font-feature);
      }

      .search-input input:focus {
        background: var(--supporting-white);
        border-color: var(--secondary-color);
        color: var(--text-dark);
        box-shadow: 0 0 0 2px rgba(69, 104, 130, 0.15);
        outline: none;
        width: 220px;
      }

      .search-input input:focus + .search-icon {
        color: var(--primary-color);
        transform: translateY(-50%) scale(1.1);
      }

      /* Responsive search input */
      @media (max-width: 1199px) {
        .search-input input {
          width: 180px;
        }
        .search-input input:focus {
          width: 220px;
        }
      }

      @media (max-width: 991px) {
        .search-input input {
          width: 100%;
          max-width: 300px;
        }
        .search-input input:focus {
          width: 100%;
        }
      }

      .clear-search-btn {
        position: absolute;
        top: 50%;
        right: 1rem;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        z-index: 3;
        padding: 0;
        width: 20px;
        height: 20px;
        display: none;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .clear-search-btn:hover {
        color: var(--danger-color);
        background: rgba(239, 68, 68, 0.1);
        transform: translateY(-50%) scale(1.1);
      }

      .clear-search-btn.show {
        display: flex;
      }

      /* Enhanced Header Icons */
      .header-icons {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
      }

      .icon-btn {
        position: relative;
        padding: 0.6rem;
        color: var(--supporting-white);
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(249, 243, 239, 0.1);
        border: 1px solid rgba(249, 243, 239, 0.2);
        min-width: 40px;
        min-height: 40px;
        backdrop-filter: blur(10px);
        cursor: pointer;
      }

      .icon-btn:hover {
        color: var(--supporting-white);
        background: rgba(249, 243, 239, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(249, 243, 239, 0.3);
        text-decoration: none;
        border-color: rgba(249, 243, 239, 0.4);
      }

      .icon-btn:active {
        transform: translateY(0) scale(0.95);
        transition: all 0.1s ease;
      }

      .icon-btn:focus {
        outline: 2px solid rgba(249, 243, 239, 0.6);
        outline-offset: 2px;
      }

      /* Enhanced touch targets for mobile */
      @media (max-width: 991px) {
        .header-icons {
          gap: 0.75rem;
        }

        .icon-btn {
          min-width: 52px;
          min-height: 52px;
          padding: 0.875rem;
        }
      }

      @media (max-width: 575px) {
        .header-icons {
          gap: 0.5rem;
        }

        .icon-btn {
          min-width: 48px;
          min-height: 48px;
          padding: 0.75rem;
        }
      }

      .icon-btn .count {
        position: absolute;
        top: -4px;
        right: -4px;
        background: linear-gradient(135deg, var(--error-red), #ff6b6b);
        color: white;
        border-radius: 50%;
        font-size: 0.7rem;
        min-width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-family: var(--font-feature);
        border: 2px solid var(--supporting-white);
        box-shadow: 0 2px 8px rgba(214, 48, 49, 0.4);
        animation: countPulse 2s infinite;
      }

      @keyframes countPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      /* Hide badge when count is 0 for better UX */
      .icon-btn .count[data-count="0"] {
        display: none;
      }

      /* Dropdown Menu */
      .dropdown-menu {
        border-radius: 16px;
        padding: 0.75rem 0;
        min-width: 240px;
        box-shadow: var(--shadow-dropdown);
        background: rgba(249, 243, 239, 0.98);
        border: 1px solid rgba(210, 193, 182, 0.3);
        backdrop-filter: blur(15px);
        font-family: var(--font-feature);
      }

      .dropdown-item {
        padding: 0.75rem 1.25rem;
        display: flex;
        align-items: center;
        color: var(--primary-color);
        font-weight: 500;
        background-color: transparent;
        border-radius: 8px;
        margin: 0.25rem 0.5rem;
        transition: all 0.3s ease;
      }

      .dropdown-item:hover {
        background: var(--gradient-primary);
        color: var(--supporting-white);
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(27, 60, 83, 0.3);
      }

      .dropdown-item i {
        margin-right: 0.75rem;
        font-size: 1.1rem;
        color: var(--secondary-color);
        transition: all 0.3s ease;
      }

      .dropdown-item:hover i {
        color: var(--accent-cream);
        transform: scale(1.1);
      }

      .dropdown-divider {
        margin: 0.5rem 0.5rem;
        border-color: rgba(210, 193, 182, 0.4);
      }

      /* Search Results */
      .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(249, 243, 239, 0.98);
        border: 1px solid rgba(210, 193, 182, 0.3);
        border-radius: 12px;
        box-shadow: var(--shadow-dropdown);
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        backdrop-filter: blur(15px);
        margin-top: 0.5rem;
      }

      .search-results.show {
        display: block;
        animation: fadeInUp 0.3s ease;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .search-result-item {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid rgba(210, 193, 182, 0.2);
        text-decoration: none;
        color: var(--text-dark);
        transition: all 0.3s ease;
        border-radius: 8px;
        margin: 0.25rem 0.5rem;
      }

      .search-result-item:hover {
        background: var(--gradient-primary);
        color: var(--supporting-white);
        text-decoration: none;
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(27, 60, 83, 0.3);
      }

      .search-result-item:last-child {
        border-bottom: none;
      }

      .search-result-item img {
        width: 45px;
        height: 60px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 1rem;
        border: 1px solid rgba(210, 193, 182, 0.3);
        transition: all 0.3s ease;
      }

      .search-result-item:hover img {
        border-color: var(--accent-cream);
        transform: scale(1.05);
      }

      .search-result-item .model {
        font-size: 0.95rem;
        font-weight: 600;
        font-family: var(--font-feature);
        margin-bottom: 0.25rem;
      }

      .search-result-item .brand {
        font-size: 0.8rem;
        font-family: var(--font-body);
        opacity: 0.8;
      }

      .no-results {
        padding: 1.25rem;
        text-align: center;
        color: var(--secondary-color);
        font-size: 0.9rem;
        font-family: var(--font-feature);
      }

      /* Mobile Search */
      .mobile-search {
        display: none;
        width: 100%;
        margin-bottom: 1rem;
      }

      /* Small Laptops - Optimize spacing */
      @media (min-width: 1024px) and (max-width: 1199px) {
        .search-input input {
          width: 180px;
        }

        .navbar-elegant-theme .navbar-brand {
          font-size: 1.3rem;
        }

        .navbar-elegant-theme .nav-link {
          padding: 0.4rem 0.5rem;
          font-size: 0.85rem;
        }

        .header-icons .icon-btn {
          padding: 0.4rem;
          margin: 0 0.2rem;
        }
      }

      /* Tablet Responsive */
      @media (max-width: 1023px) {
        .search-input input {
          width: 160px;
        }

        .navbar-elegant-theme .nav-link {
          padding: 0.4rem 0.4rem;
        }
      }

      /* Mobile Responsive */
      @media (max-width: 991.98px) {
        .navbar-elegant-theme .container {
          flex-direction: column;
          align-items: stretch;
        }

        .navbar-brand-section {
          display: flex;
          justify-content: space-between;
          align-items: center;
          width: 100%;
          min-width: auto;
        }

        /* Mobile Action Icons - Always Visible */
        .mobile-action-icons {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-right: 0.5rem;
        }

        .mobile-action-icons .icon-btn {
          min-width: 44px;
          min-height: 44px;
          padding: 0.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .search-input.d-none.d-lg-block {
          display: none !important;
        }

        .mobile-search {
          display: block;
        }

        .search-results {
          width: 100%;
        }

        /* Mobile Navigation Styles */
        .mobile-navbar {
          background: linear-gradient(135deg, #1b3c53, #456882);
          padding: 0.75rem 0;
          z-index: 1030;
        }

        .mobile-nav-toggle {
          background: none;
          border: none;
          color: var(--supporting-white);
          font-size: 1.5rem;
          padding: 0.5rem;
          border-radius: 8px;
          transition: all 0.3s ease;
          min-width: 44px;
          min-height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .mobile-nav-toggle:hover {
          background: rgba(255, 255, 255, 0.1);
          transform: scale(1.05);
        }

      }

      /* Mobile Navigation Styles - Only for Mobile */
      @media (max-width: 991.98px) {
        /* Mobile Navigation Overlay */
        .mobile-nav-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1040;
          opacity: 0;
          visibility: hidden;
          transition: all 0.3s ease;
        }

        .mobile-nav-overlay.show {
          opacity: 1;
          visibility: visible;
        }

        /* Mobile Navigation Sidebar */
        .mobile-nav-sidebar {
          position: fixed;
          top: 0;
          right: -100%;
          width: 320px;
          max-width: 85vw;
          height: 100%;
          background: linear-gradient(135deg, rgba(27, 60, 83, 0.98), rgba(69, 104, 130, 0.98));
          backdrop-filter: blur(20px);
          z-index: 1050;
          transition: right 0.3s ease;
          overflow-y: auto;
          box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
        }

        .mobile-nav-sidebar.show {
          right: 0;
        }

        /* Mobile Navigation Header */
        .mobile-nav-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mobile-nav-brand {
          display: flex;
          align-items: center;
          color: var(--supporting-white);
          font-weight: 600;
        }

        .mobile-nav-brand img {
          width: 32px;
          height: 32px;
          margin-right: 0.5rem;
        }

        .mobile-nav-close {
          background: none;
          border: none;
          color: var(--supporting-white);
          font-size: 1.5rem;
          padding: 0.5rem;
          border-radius: 8px;
          transition: all 0.3s ease;
          min-width: 44px;
          min-height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .mobile-nav-close:hover {
          background: rgba(255, 255, 255, 0.1);
          transform: scale(1.05);
        }

        /* Mobile Navigation Content */
        .mobile-nav-content {
          padding: 1.5rem;
        }

        .mobile-nav-links {
          margin-bottom: 2rem;
        }

        .mobile-nav-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem 1.25rem;
          color: var(--supporting-white);
          text-decoration: none;
          border-radius: 12px;
          margin-bottom: 0.5rem;
          transition: all 0.3s ease;
          font-weight: 500;
          font-size: 1.1rem;
          min-height: 52px;
        }

        .mobile-nav-item:hover,
        .mobile-nav-item.active {
          background: rgba(255, 255, 255, 0.15);
          color: var(--supporting-white);
          transform: translateX(8px);
        }

        .mobile-nav-item i {
          font-size: 1.3rem;
          width: 24px;
          text-align: center;
        }

        /* Mobile Navigation Search */
        .mobile-nav-search {
          margin-bottom: 2rem;
        }

        .mobile-nav-search .search-input {
          position: relative;
          width: 100%;
        }

        .mobile-nav-search .search-field {
          width: 100%;
          padding: 1rem 3rem 1rem 1rem;
          border: 2px solid rgba(255, 255, 255, 0.2);
          border-radius: 12px;
          background: rgba(255, 255, 255, 0.1);
          color: var(--supporting-white);
          font-size: 1rem;
          transition: all 0.3s ease;
        }

        .mobile-nav-search .search-field::placeholder {
          color: rgba(255, 255, 255, 0.7);
        }

        .mobile-nav-search .search-field:focus {
          outline: none;
          border-color: rgba(255, 255, 255, 0.4);
          background: rgba(255, 255, 255, 0.15);
        }

        .mobile-nav-search .search-icon {
          position: absolute;
          right: 1rem;
          top: 50%;
          transform: translateY(-50%);
          color: rgba(255, 255, 255, 0.7);
          font-size: 1.2rem;
        }

        /* Mobile Navigation Authentication */
        .mobile-nav-auth {
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          padding-top: 1.5rem;
        }

        .mobile-auth-links {
          display: flex;
          flex-direction: column;
          gap: 0.75rem;
        }

        .mobile-auth-link {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem 1.25rem;
          background: rgba(255, 255, 255, 0.1);
          border: 2px solid rgba(255, 255, 255, 0.2);
          border-radius: 12px;
          color: var(--supporting-white);
          text-decoration: none;
          font-weight: 500;
          font-size: 1.1rem;
          transition: all 0.3s ease;
          min-height: 52px;
        }

        .mobile-auth-link:hover {
          background: rgba(255, 255, 255, 0.2);
          border-color: rgba(255, 255, 255, 0.4);
          color: var(--supporting-white);
          transform: translateX(8px);
        }

        .mobile-auth-link i {
          font-size: 1.3rem;
          width: 24px;
          text-align: center;
        }
      }

        .search-input input {
          width: 100%;
          min-height: 52px;
          font-size: 1.1rem;
          padding: 1rem 3rem 1rem 3rem;
        }

        .header-icons {
          justify-content: center;
          flex-wrap: wrap;
          gap: 1rem;
        }
      }

      @media (max-width: 575.98px) {
        .navbar-elegant-theme .navbar-brand {
          font-size: 1.2rem !important;
        }

        .navbar-elegant-theme .navbar-brand img {
          height: 28px;
        }

        .navbar-elegant-theme .navbar-collapse {
          margin-top: 0.5rem;
          width: 80%;
          max-width: 320px;
        }

        .mobile-nav-content {
          padding: 1rem;
        }

        .mobile-auth-link {
          padding: 0.875rem 1rem;
          font-size: 1rem;
          min-height: 48px;
        }

        .mobile-auth-link i {
          font-size: 1.2rem;
        }

        .navbar-elegant-theme .nav-link {
          padding: 0.7rem 0.8rem !important;
          font-size: 0.9rem;
          min-height: 40px;
        }

        .icon-btn {
          padding: 0.75rem;
          min-width: 48px;
          min-height: 48px;
        }

        .search-input input {
          padding: 0.875rem 2.75rem 0.875rem 2.75rem;
          min-height: 48px;
          font-size: 1rem;
        }

        .header-icons {
          gap: 0.75rem;
        }

        .mobile-search {
          margin-bottom: 0.75rem;
        }

        /* Improve touch targets */
        .clear-search-btn {
          min-width: 32px;
          min-height: 32px;
        }

        .search-icon {
          font-size: 1.1rem;
        }
      }

      /* Additional Elegant Effects */
      .navbar-elegant-theme {
        position: relative;
      }

      .navbar-elegant-theme::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(249, 243, 239, 0.1) 50%,
          transparent 70%
        );
        animation: shimmer 3s infinite;
        pointer-events: none;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* User Dropdown Enhancement */
      .user-dropdown .dropdown-toggle::after {
        display: none;
      }

      .user-dropdown .icon-btn {
        position: relative;
      }

      .user-dropdown .icon-btn::after {
        content: "";
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 8px;
        height: 8px;
        background: var(--success-green);
        border-radius: 50%;
        border: 2px solid var(--supporting-white);
      }

      /* Scroll Effect */
      .navbar-scrolled {
        background: linear-gradient(
          135deg,
          rgba(27, 60, 83, 0.95),
          rgba(69, 104, 130, 0.95)
        ) !important;
        backdrop-filter: blur(20px);
      }
      /* Fixed navbar body compensation */
      body {
        padding-top: 65px !important;
      }

      @media (max-width: 991.98px) {
        body {
          padding-top: 60px !important;
        }
      }

      @media (max-width: 575.98px) {
        body {
          padding-top: 55px !important;
        }
      }
    </style>
  </head>

  <body class="paper-texture">
    <!-- Desktop Navigation -->
    <nav class="navbar navbar-expand-lg navbar-elegant-theme shadow-sm fixed-top d-none d-lg-block">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center w-100">
          <!-- Brand -->
          <a class="navbar-brand" href="/">
            <img src="/assets/phoenix-logo.png" alt="Phoenix Logo" />
            <span class="ms-2 fw-bold">Phoenix</span>
          </a>

          <!-- Center Navigation Links -->
          <ul class="navbar-nav d-flex flex-row">
            <li class="nav-item">
              <a class="nav-link fw-medium" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link fw-medium" href="/shopPage">Shop</a>
            </li>
            <li class="nav-item">
              <a class="nav-link fw-medium" href="/about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link fw-medium" href="/contact">Contact</a>
            </li>
          </ul>

          <!-- Desktop Search Bar -->
          <div class="desktop-search-container">
            <div class="search-input-wrapper">
              <input
                type="text"
                class="search-input"
                id="desktopSearchInput"
                placeholder="Search products..."
                autocomplete="off"
                aria-label="Search products"
                aria-describedby="search-help"
                aria-expanded="false"
                aria-haspopup="listbox"
                aria-owns="desktopSearchResults"
                role="combobox"
              />
              <div class="search-icon">
                <i class="ri-search-line"></i>
              </div>
              <button
                type="button"
                class="clear-search-btn"
                id="desktopClearBtn"
                title="Clear search"
                aria-label="Clear search"
                aria-hidden="true"
                tabindex="-1"
              >
                <i class="ri-close-line" aria-hidden="true"></i>
              </button>
            </div>
            <div class="search-results-dropdown" id="desktopSearchResults" role="listbox" aria-label="Search results">
              <!-- Search results will be populated here -->
            </div>
            <div id="search-help" class="sr-only">Type at least 2 characters to search for products</div>
          </div>

          <!-- Right Section - Auth & Icons -->
          <div class="desktop-actions d-flex align-items-center gap-3">
            <!-- Action Icons -->
            <% if (!locals.isAuthenticated) { %>
            <a href="/login" class="icon-btn" title="Wishlist">
              <i class="ri-heart-line fs-5"></i>
              <span class="count wishlist-count">0</span>
            </a>
            <a href="/login" class="icon-btn cart-link" title="Cart">
              <i class="ri-shopping-bag-line fs-5"></i>
              <span class="count cart-count">0</span>
            </a>
            <a href="/login" class="btn btn-outline-light me-2">Login</a>
            <a href="/signup" class="btn btn-light">Sign Up</a>
            <% } else { %>
            <a href="/wishlist" class="icon-btn" title="Wishlist">
              <i class="ri-heart-line fs-5"></i>
              <span
                class="count wishlist-count"
                data-count="<%= locals.wishlistCount || 0 %>"
                ><%= locals.wishlistCount || 0 %></span
              >
            </a>
            <a href="/cart" class="icon-btn cart-link" title="Cart">
              <i class="ri-shopping-bag-line fs-5"></i>
              <span
                class="count cart-count"
                data-count="<%= locals.cartCount || 0 %>"
                ><%= locals.cartCount || 0 %></span
              >
            </a>
            <div class="dropdown user-dropdown">
              <a
                class="icon-btn dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                id="userDropdown"
                title="Account"
              >
                <i class="ri-user-line fs-5"></i>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="userDropdown"
              >
                <li>
                  <a class="dropdown-item" href="/profile">
                    <i class="ri-user-3-line"></i> Your Profile
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="/logout">
                    <i class="ri-logout-box-line"></i> Logout
                  </a>
                </li>
              </ul>
            </div>
            <% } %>
          </div>
        </div>
      </div>
    </nav>

    <!-- Mobile Navigation -->
    <nav class="mobile-navbar d-lg-none fixed-top">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center">
          <!-- Brand -->
          <a class="navbar-brand" href="/">
            <img src="/assets/phoenix-logo.png" alt="Phoenix Logo" />
            <span class="ms-2 fw-bold">Phoenix</span>
          </a>

          <!-- Mobile Action Icons -->
          <div class="mobile-actions d-flex align-items-center gap-2">
            <% if (!locals.isAuthenticated) { %>
            <a href="/login" class="icon-btn" title="Wishlist">
              <i class="ri-heart-line fs-5"></i>
              <span class="count wishlist-count" id="wishlistCountMobile">0</span>
            </a>
            <a href="/login" class="icon-btn cart-link" title="Cart">
              <i class="ri-shopping-bag-line fs-5"></i>
              <span class="count cart-count" id="cartCountMobile">0</span>
            </a>
            <% } else { %>
            <a href="/wishlist" class="icon-btn" title="Wishlist">
              <i class="ri-heart-line fs-5"></i>
              <span
                class="count wishlist-count"
                id="wishlistCountMobile"
                data-count="<%= locals.wishlistCount || 0 %>"
                ><%= locals.wishlistCount || 0 %></span
              >
            </a>
            <a href="/cart" class="icon-btn cart-link" title="Cart">
              <i class="ri-shopping-bag-line fs-5"></i>
              <span
                class="count cart-count"
                id="cartCountMobile"
                data-count="<%= locals.cartCount || 0 %>"
                ><%= locals.cartCount || 0 %></span
              >
            </a>
            <% } %>

            <!-- Mobile Menu Toggle -->
            <button
              class="mobile-nav-toggle"
              type="button"
              id="mobileNavToggle"
              aria-label="Toggle navigation"
            >
              <i class="ri-menu-line"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Mobile Navigation Overlay - Hidden on Desktop -->
    <div class="mobile-nav-overlay d-lg-none" id="mobileNavOverlay"></div>

    <!-- Mobile Navigation Sidebar - Hidden on Desktop -->
    <div class="mobile-nav-sidebar d-lg-none" id="mobileNavSidebar">
      <div class="mobile-nav-header">
        <div class="mobile-nav-brand">
          <img src="/assets/phoenix-logo.png" alt="Phoenix Logo" />
          <span class="fw-bold">Phoenix</span>
        </div>
        <button class="mobile-nav-close" id="mobileNavClose">
          <i class="ri-close-line"></i>
        </button>
      </div>

      <div class="mobile-nav-content">
        <!-- Navigation Links -->
        <div class="mobile-nav-links">
          <a href="/" class="mobile-nav-item">
            <i class="ri-home-line"></i>
            <span>Home</span>
          </a>
          <a href="/shopPage" class="mobile-nav-item">
            <i class="ri-store-line"></i>
            <span>Shop</span>
          </a>
          <a href="/about" class="mobile-nav-item">
            <i class="ri-information-line"></i>
            <span>About</span>
          </a>
          <a href="/contact" class="mobile-nav-item">
            <i class="ri-phone-line"></i>
            <span>Contact</span>
          </a>
        </div>

        <!-- Search Section -->
        <div class="mobile-nav-search">
          <div class="search-input">
            <input
              type="text"
              class="form-control search-field"
              placeholder="Search premium headphones..."
            />
            <div class="search-icon">
              <i class="ri-search-line"></i>
            </div>
            <button type="button" class="clear-search-btn" title="Clear search">
              <i class="ri-close-line"></i>
            </button>
            <div class="search-results" id="mobileSearchResults"></div>
          </div>
        </div>

        <!-- Authentication Section -->
        <div class="mobile-nav-auth">
          <% if (!locals.isAuthenticated) { %>
          <div class="mobile-auth-links">
            <a href="/login" class="mobile-auth-link">
              <i class="ri-login-box-line"></i>
              <span>Login</span>
            </a>
            <a href="/signup" class="mobile-auth-link">
              <i class="ri-user-add-line"></i>
              <span>Sign Up</span>
            </a>
          </div>
          <% } else { %>
          <div class="mobile-auth-links">
            <a href="/profile" class="mobile-auth-link">
              <i class="ri-user-3-line"></i>
              <span>Your Profile</span>
            </a>
            <a href="/logout" class="mobile-auth-link logout-link">
              <i class="ri-logout-box-line"></i>
              <span>Logout</span>
            </a>
          </div>
          <% } %>
        </div>
      </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Blocked User Handler - Must be loaded early -->
    <script src="/js/blockedUserHandler.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchFields = document.querySelectorAll(".search-field");
        const desktopResults = document.getElementById("desktopSearchResults");
        const mobileResults = document.getElementById("mobileSearchResults");
        const navbar = document.querySelector(".navbar");
        let debounceTimeout;

        // Desktop search elements
        const desktopSearchInput = document.getElementById('desktopSearchInput');
        const desktopClearBtn = document.getElementById('desktopClearBtn');
        const desktopSearchResults = document.getElementById('desktopSearchResults');

        // Enhanced scroll effect for navbar
        let ticking = false;
        function updateNavbarOnScroll() {
          if (window.scrollY > 50) {
            navbar.classList.add("navbar-scrolled");
          } else {
            navbar.classList.remove("navbar-scrolled");
          }
          ticking = false;
        }

        window.addEventListener("scroll", function () {
          if (!ticking) {
            requestAnimationFrame(updateNavbarOnScroll);
            ticking = true;
          }
        });

        // Mobile Navigation Functionality (ArvenClaire Style)
        const mobileNavToggle = document.getElementById('mobileNavToggle');
        const mobileNavOverlay = document.getElementById('mobileNavOverlay');
        const mobileNavSidebar = document.getElementById('mobileNavSidebar');
        const mobileNavClose = document.getElementById('mobileNavClose');

        // Open mobile navigation
        if (mobileNavToggle) {
          mobileNavToggle.addEventListener('click', function() {
            mobileNavOverlay.classList.add('show');
            mobileNavSidebar.classList.add('show');
            document.body.style.overflow = 'hidden';

            // Add haptic feedback on mobile devices
            if ('vibrate' in navigator) {
              navigator.vibrate(50);
            }
          });
        }

        // Close mobile navigation
        function closeMobileNav() {
          mobileNavOverlay.classList.remove('show');
          mobileNavSidebar.classList.remove('show');
          document.body.style.overflow = '';
        }

        if (mobileNavClose) {
          mobileNavClose.addEventListener('click', closeMobileNav);
        }

        if (mobileNavOverlay) {
          mobileNavOverlay.addEventListener('click', closeMobileNav);
        }

        // Close on escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && mobileNavSidebar.classList.contains('show')) {
            closeMobileNav();
          }
        });

        // Set active nav item in mobile menu
        const currentPath = window.location.pathname;
        const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
        mobileNavItems.forEach(item => {
          const itemPath = new URL(item.href).pathname;
          if (itemPath === currentPath ||
              (currentPath === '/' && itemPath === '/') ||
              (currentPath === '/shopPage' && itemPath === '/shopPage') ||
              (currentPath === '/about' && itemPath === '/about') ||
              (currentPath === '/contact' && itemPath === '/contact')) {
            item.classList.add('active');
          }
        });

        // Responsive navigation handler
        function handleResponsiveNavigation() {
          const mainNavbar = document.getElementById("mainNavbar");
          const moreDropdown = document.getElementById("moreDropdown");
          const moreDropdownMenu = document.getElementById("moreDropdownMenu");

          if (!mainNavbar || !moreDropdown || !moreDropdownMenu) return;

          // Only apply responsive behavior on desktop/tablet (not mobile collapsed view)
          if (window.innerWidth >= 992) {
            const navItems = Array.from(mainNavbar.children).filter(item =>
              !item.id || item.id !== 'moreDropdown'
            );
            const containerWidth = mainNavbar.parentElement.offsetWidth;
            let totalWidth = 0;
            let visibleItems = [];
            let hiddenItems = [];

            // Calculate which items fit
            navItems.forEach((item, index) => {
              const itemWidth = item.offsetWidth + 16; // Add margin
              if (totalWidth + itemWidth + 100 < containerWidth) { // Reserve space for "More"
                totalWidth += itemWidth;
                visibleItems.push(item);
              } else {
                hiddenItems.push(item);
              }
            });

            // Show/hide More dropdown based on hidden items
            if (hiddenItems.length > 0) {
              moreDropdown.classList.remove("d-none");

              // Move hidden items to dropdown
              moreDropdownMenu.innerHTML = '';
              hiddenItems.forEach(item => {
                const link = item.querySelector('a');
                if (link) {
                  const dropdownItem = document.createElement('li');
                  const dropdownLink = document.createElement('a');
                  dropdownLink.className = 'dropdown-item';
                  dropdownLink.href = link.href;
                  dropdownLink.textContent = link.textContent;
                  dropdownItem.appendChild(dropdownLink);
                  moreDropdownMenu.appendChild(dropdownItem);
                }
              });
            } else {
              moreDropdown.classList.add("d-none");
            }
          } else {
            // On mobile, hide the More dropdown as all items are shown in collapsed menu
            moreDropdown.classList.add("d-none");
          }
        }

        // Initialize responsive navigation
        handleResponsiveNavigation();

        // Handle window resize
        let resizeTimeout;
        window.addEventListener("resize", function() {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(handleResponsiveNavigation, 250);
        });

        // Enhanced keyboard navigation
        function enhanceKeyboardNavigation() {
          const navLinks = document.querySelectorAll('.navbar .nav-link, .navbar .dropdown-item');
          const dropdownToggles = document.querySelectorAll('.navbar .dropdown-toggle');

          // Handle keyboard navigation for nav links
          navLinks.forEach((link, index) => {
            link.addEventListener('keydown', function(e) {
              switch(e.key) {
                case 'ArrowRight':
                case 'ArrowDown':
                  e.preventDefault();
                  const nextLink = navLinks[index + 1];
                  if (nextLink) {
                    nextLink.focus();
                  } else {
                    navLinks[0].focus(); // Wrap to first
                  }
                  break;
                case 'ArrowLeft':
                case 'ArrowUp':
                  e.preventDefault();
                  const prevLink = navLinks[index - 1];
                  if (prevLink) {
                    prevLink.focus();
                  } else {
                    navLinks[navLinks.length - 1].focus(); // Wrap to last
                  }
                  break;
                case 'Home':
                  e.preventDefault();
                  navLinks[0].focus();
                  break;
                case 'End':
                  e.preventDefault();
                  navLinks[navLinks.length - 1].focus();
                  break;
              }
            });
          });

          // Handle dropdown keyboard navigation
          dropdownToggles.forEach(toggle => {
            toggle.addEventListener('keydown', function(e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                const dropdown = toggle.closest('.dropdown');
                const menu = dropdown.querySelector('.dropdown-menu');
                const isExpanded = toggle.getAttribute('aria-expanded') === 'true';

                if (!isExpanded) {
                  // Open dropdown and focus first item
                  toggle.click();
                  setTimeout(() => {
                    const firstItem = menu.querySelector('.dropdown-item');
                    if (firstItem) firstItem.focus();
                  }, 100);
                } else {
                  // Close dropdown
                  toggle.click();
                }
              } else if (e.key === 'Escape') {
                // Close dropdown and return focus to toggle
                const dropdown = toggle.closest('.dropdown');
                const menu = dropdown.querySelector('.dropdown-menu');
                if (menu.classList.contains('show')) {
                  toggle.click();
                  toggle.focus();
                }
              }
            });
          });
        }

        // Initialize keyboard navigation
        enhanceKeyboardNavigation();

        // Enhanced dropdown interactions
        function enhanceDropdownInteractions() {
          const dropdownItems = document.querySelectorAll('.navbar .dropdown-item');

          // Add ripple effect on click
          dropdownItems.forEach(item => {
            item.addEventListener('click', function(e) {
              // Create ripple element
              const ripple = document.createElement('span');
              const rect = this.getBoundingClientRect();
              const size = Math.max(rect.width, rect.height);
              const x = e.clientX - rect.left - size / 2;
              const y = e.clientY - rect.top - size / 2;

              ripple.style.width = ripple.style.height = size + 'px';
              ripple.style.left = x + 'px';
              ripple.style.top = y + 'px';
              ripple.classList.add('ripple');

              // Remove existing ripples
              const existingRipples = this.querySelectorAll('.ripple');
              existingRipples.forEach(r => r.remove());

              // Add new ripple
              this.appendChild(ripple);
              this.classList.add('ripple');

              // Remove ripple after animation
              setTimeout(() => {
                ripple.remove();
                this.classList.remove('ripple');
              }, 600);
            });

            // Enhanced hover effects
            item.addEventListener('mouseenter', function() {
              this.style.setProperty('--hover-scale', '1.02');
            });

            item.addEventListener('mouseleave', function() {
              this.style.setProperty('--hover-scale', '1');
            });
          });

          // Smooth dropdown animations
          const dropdownMenus = document.querySelectorAll('.navbar .dropdown-menu');
          dropdownMenus.forEach(menu => {
            const dropdown = menu.closest('.dropdown');
            const toggle = dropdown.querySelector('.dropdown-toggle');

            // Enhanced show/hide animations
            const observer = new MutationObserver((mutations) => {
              mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                  if (menu.classList.contains('show')) {
                    // Stagger item animations
                    const items = menu.querySelectorAll('.dropdown-item');
                    items.forEach((item, index) => {
                      item.style.animationDelay = `${0.1 + (index * 0.05)}s`;
                    });
                  }
                }
              });
            });

            observer.observe(menu, { attributes: true });
          });
        }

        // Initialize enhanced dropdown interactions
        enhanceDropdownInteractions();

        // Enhanced mobile dropdown behavior
        function enhanceMobileDropdowns() {
          const userDropdown = document.querySelector('.user-dropdown');
          const userDropdownToggle = document.querySelector('.user-dropdown .dropdown-toggle');
          const userDropdownMenu = document.querySelector('.user-dropdown .dropdown-menu');

          if (userDropdown && userDropdownToggle && userDropdownMenu) {
            // Handle mobile dropdown behavior
            function handleMobileDropdown() {
              if (window.innerWidth <= 767) {
                // Mobile behavior: ensure dropdown stays within navbar collapse
                userDropdownMenu.style.position = 'static';
                userDropdownMenu.style.transform = 'none';

                // Add smooth animation for mobile
                userDropdownMenu.addEventListener('show.bs.dropdown', function() {
                  this.style.animation = 'slideInFromLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                });

                userDropdownMenu.addEventListener('hide.bs.dropdown', function() {
                  this.style.animation = 'slideOutToLeft 0.3s ease-out';
                });

                // Add haptic feedback for mobile interactions
                userDropdownToggle.addEventListener('click', function() {
                  if ('vibrate' in navigator) {
                    navigator.vibrate(30);
                  }
                });

                // Enhanced touch feedback for dropdown items
                const dropdownItems = userDropdownMenu.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                  item.addEventListener('touchstart', function() {
                    this.style.transform = 'translateX(4px) scale(0.98)';
                  });

                  item.addEventListener('touchend', function() {
                    setTimeout(() => {
                      this.style.transform = '';
                    }, 150);
                  });

                  item.addEventListener('click', function() {
                    if ('vibrate' in navigator) {
                      navigator.vibrate(20);
                    }
                  });
                });
              } else {
                // Desktop behavior: restore normal dropdown styles
                userDropdownMenu.style.position = '';
                userDropdownMenu.style.transform = '';
                userDropdownMenu.style.animation = '';
              }
            }

            // Initialize and handle resize
            handleMobileDropdown();
            window.addEventListener('resize', debounce(handleMobileDropdown, 250));

            // Prevent dropdown from closing navbar collapse on mobile
            userDropdownMenu.addEventListener('click', function(e) {
              if (window.innerWidth <= 767) {
                e.stopPropagation();
              }
            });

            // Enhanced accessibility for mobile
            userDropdownToggle.addEventListener('keydown', function(e) {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
              }
            });

            // Auto-close dropdown when clicking dropdown items on mobile
            const dropdownItems = userDropdownMenu.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(item => {
              item.addEventListener('click', function() {
                if (window.innerWidth <= 767) {
                  // Close dropdown after a short delay to show the interaction
                  setTimeout(() => {
                    const dropdown = bootstrap.Dropdown.getInstance(userDropdownToggle);
                    if (dropdown) {
                      dropdown.hide();
                    }
                  }, 200);
                }
              });
            });
          }
        }

        // Initialize mobile dropdown enhancements
        enhanceMobileDropdowns();

        // Enhanced mobile navbar containment
        function ensureMobileNavbarContainment() {
          const navbarCollapse = document.querySelector('.navbar-collapse');
          const navbarToggler = document.querySelector('.navbar-toggler');

          if (navbarCollapse && navbarToggler) {
            // Monitor navbar collapse state
            function handleNavbarToggle() {
              const isExpanded = navbarToggler.getAttribute('aria-expanded') === 'true';

              if (isExpanded && window.innerWidth <= 767) {
                // Ensure navbar collapse stays within viewport
                const viewportHeight = window.innerHeight;
                const navbarTop = navbarCollapse.getBoundingClientRect().top;
                const maxHeight = viewportHeight - navbarTop - 20; // 20px buffer

                navbarCollapse.style.maxHeight = `${maxHeight}px`;
                navbarCollapse.style.overflowY = 'auto';
                navbarCollapse.style.overflowX = 'hidden';

                // Prevent body scroll when navbar is open
                document.body.style.overflow = 'hidden';

                // Ensure all dropdowns stay within container
                const dropdowns = navbarCollapse.querySelectorAll('.dropdown-menu');
                dropdowns.forEach(dropdown => {
                  dropdown.style.position = 'static';
                  dropdown.style.transform = 'none';
                  dropdown.style.width = '100%';
                  dropdown.style.maxWidth = 'none';
                  dropdown.style.left = 'auto';
                  dropdown.style.right = 'auto';
                  dropdown.style.top = 'auto';
                });
              } else {
                // Restore normal behavior for desktop
                navbarCollapse.style.maxHeight = '';
                navbarCollapse.style.overflowY = '';
                navbarCollapse.style.overflowX = '';
                document.body.style.overflow = '';
              }
            }

            // Listen for navbar toggle events
            navbarToggler.addEventListener('click', function() {
              // Use setTimeout to ensure aria-expanded is updated
              setTimeout(handleNavbarToggle, 10);
            });

            // Handle window resize
            window.addEventListener('resize', debounce(function() {
              if (window.innerWidth > 767) {
                // Reset mobile styles on desktop
                navbarCollapse.style.maxHeight = '';
                navbarCollapse.style.overflowY = '';
                navbarCollapse.style.overflowX = '';
                document.body.style.overflow = '';
              } else {
                handleNavbarToggle();
              }
            }, 250));

            // Handle clicks outside navbar to close it
            document.addEventListener('click', function(e) {
              if (window.innerWidth <= 767) {
                const isClickInsideNavbar = navbarCollapse.contains(e.target) || navbarToggler.contains(e.target);
                const isNavbarExpanded = navbarToggler.getAttribute('aria-expanded') === 'true';

                if (!isClickInsideNavbar && isNavbarExpanded) {
                  navbarToggler.click(); // Close navbar
                  document.body.style.overflow = ''; // Restore body scroll
                }
              }
            });
          }
        }

        // Initialize mobile navbar containment
        ensureMobileNavbarContainment();

        function debounce(func, wait) {
          return function (...args) {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(() => func.apply(this, args), wait);
          };
        }

        async function fetchSearchResults(query) {
          try {
            const response = await fetch(
              `/search?q=${encodeURIComponent(query)}`
            );
            if (!response.ok) throw new Error("Network response was not ok");
            const products = await response.json();
            return products;
          } catch (error) {
            console.error("Error fetching search results:", error);
            return [];
          }
        }

        function renderSearchResults(products, resultsContainer) {
          resultsContainer.innerHTML = "";
          if (products.length === 0) {
            resultsContainer.innerHTML =
              '<div class="no-results">No premium headphones found matching your search.</div>';
            resultsContainer.classList.add("show");
            return;
          }

          products.forEach((product) => {
            const item = document.createElement("a");
            item.href = `/products/${product._id}`;
            item.classList.add("search-result-item");
            item.innerHTML = `
              <img src="${
                product.mainImage || "/api/placeholder/500/600"
              }" alt="${product.model}" />
              <div>
                <div class="model">${product.model}</div>
                <div class="brand">${product.brand}</div>
              </div>
            `;
            resultsContainer.appendChild(item);
          });
          resultsContainer.classList.add("show");
        }

        function renderDesktopSearchResults(products, resultsContainer) {
          resultsContainer.innerHTML = "";

          if (products.length === 0) {
            resultsContainer.innerHTML = '<div class="search-no-results">No products found matching your search.</div>';
            resultsContainer.classList.add("show");
            return;
          }

          products.forEach((product, index) => {
            const item = document.createElement("a");
            item.href = `/products/${product._id}`;
            item.classList.add("search-result-item");
            item.setAttribute('role', 'option');
            item.setAttribute('tabindex', '-1');

            item.innerHTML = `
              <img
                src="${product.mainImage || "/api/placeholder/500/600"}"
                alt="${product.model}"
                class="search-result-image"
                loading="lazy"
              />
              <div class="search-result-content">
                <div class="search-result-title">${product.model}</div>
                <div class="search-result-brand">${product.brand}</div>
              </div>
            `;

            // Add click handler
            item.addEventListener('click', function(e) {
              e.preventDefault();
              window.location.href = this.href;
            });

            // Add hover handler for keyboard navigation
            item.addEventListener('mouseenter', function() {
              // Remove active class from other items
              resultsContainer.querySelectorAll('.search-result-item.active').forEach(activeItem => {
                activeItem.classList.remove('active');
              });
              // Add active class to this item
              this.classList.add('active');
            });

            resultsContainer.appendChild(item);
          });

          resultsContainer.classList.add("show");
        }

        searchFields.forEach((field) => {
          field.addEventListener(
            "input",
            debounce(async function () {
              const query = this.value.trim();
              const resultsContainer = this.closest(".mobile-search")
                ? mobileResults
                : desktopResults;

              // Show/hide clear button based on input
              const clearBtn = this.parentElement.querySelector('.clear-search-btn');
              if (clearBtn) {
                if (query.length > 0) {
                  clearBtn.classList.add('show');
                } else {
                  clearBtn.classList.remove('show');
                }
              }

              if (query.length < 2) {
                resultsContainer.classList.remove("show");
                resultsContainer.innerHTML = "";
                return;
              }

              const products = await fetchSearchResults(query);
              renderSearchResults(products, resultsContainer);
            }, 300)
          );

          field.addEventListener("focus", function () {
            const resultsContainer = this.closest(".mobile-search")
              ? mobileResults
              : desktopResults;
            if (resultsContainer.innerHTML) {
              resultsContainer.classList.add("show");
            }
          });

          field.addEventListener("blur", function (e) {
            const resultsContainer = this.closest(".mobile-search")
              ? mobileResults
              : desktopResults;
            setTimeout(() => {
              if (!resultsContainer.contains(e.relatedTarget)) {
                resultsContainer.classList.remove("show");
              }
            }, 200);
          });
        });

        [desktopResults, mobileResults].forEach((container) => {
          container.addEventListener("mousedown", function (e) {
            e.preventDefault();
          });
        });

        // Clear search functionality
        const clearSearchButtons = document.querySelectorAll('.clear-search-btn');
        clearSearchButtons.forEach((clearBtn) => {
          clearBtn.addEventListener('click', function() {
            const searchInput = this.parentElement.querySelector('.search-field');
            const resultsContainer = this.parentElement.querySelector('.search-results');

            if (searchInput) {
              searchInput.value = '';
              searchInput.focus();
              this.classList.remove('show');
            }

            if (resultsContainer) {
              resultsContainer.classList.remove('show');
              resultsContainer.innerHTML = '';
            }
          });
        });

        // Desktop Search Functionality
        if (desktopSearchInput && desktopClearBtn && desktopSearchResults) {
          // Desktop search input handler
          desktopSearchInput.addEventListener('input', debounce(async function() {
            const query = this.value.trim();

            // Show/hide clear button
            if (query.length > 0) {
              desktopClearBtn.classList.add('show');
              desktopClearBtn.setAttribute('aria-hidden', 'false');
            } else {
              desktopClearBtn.classList.remove('show');
              desktopClearBtn.setAttribute('aria-hidden', 'true');
            }

            // Clear results if query is too short
            if (query.length < 2) {
              desktopSearchResults.classList.remove('show');
              desktopSearchResults.innerHTML = '';
              desktopSearchInput.setAttribute('aria-expanded', 'false');
              return;
            }

            // Show loading state
            desktopSearchResults.innerHTML = '<div class="search-loading" role="status" aria-live="polite">Searching...</div>';
            desktopSearchResults.classList.add('show');
            desktopSearchInput.setAttribute('aria-expanded', 'true');

            try {
              const products = await fetchSearchResults(query);
              renderDesktopSearchResults(products, desktopSearchResults);

              // Announce results to screen readers
              const resultCount = products.length;
              const announcement = resultCount === 0
                ? 'No search results found'
                : `${resultCount} search result${resultCount === 1 ? '' : 's'} found`;

              // Create temporary announcement element
              const announcer = document.createElement('div');
              announcer.setAttribute('aria-live', 'polite');
              announcer.setAttribute('aria-atomic', 'true');
              announcer.className = 'sr-only';
              announcer.textContent = announcement;
              document.body.appendChild(announcer);

              // Remove after announcement
              setTimeout(() => {
                document.body.removeChild(announcer);
              }, 1000);

            } catch (error) {
              console.error('Search error:', error);
              desktopSearchResults.innerHTML = '<div class="search-error" role="alert">Search failed. Please try again.</div>';
            }
          }, 300));

          // Desktop search focus handler
          desktopSearchInput.addEventListener('focus', function() {
            const query = this.value.trim();
            if (query.length >= 2 && desktopSearchResults.innerHTML.trim() !== '') {
              desktopSearchResults.classList.add('show');
            }
          });

          // Desktop clear button handler
          desktopClearBtn.addEventListener('click', function() {
            desktopSearchInput.value = '';
            desktopSearchInput.focus();
            desktopClearBtn.classList.remove('show');
            desktopClearBtn.setAttribute('aria-hidden', 'true');
            desktopSearchResults.classList.remove('show');
            desktopSearchResults.innerHTML = '';
            desktopSearchInput.setAttribute('aria-expanded', 'false');

            // Announce to screen readers
            const announcer = document.createElement('div');
            announcer.setAttribute('aria-live', 'polite');
            announcer.className = 'sr-only';
            announcer.textContent = 'Search cleared';
            document.body.appendChild(announcer);
            setTimeout(() => {
              document.body.removeChild(announcer);
            }, 1000);
          });

          // Desktop search blur handler
          desktopSearchInput.addEventListener('blur', function(e) {
            setTimeout(() => {
              if (!desktopSearchResults.contains(e.relatedTarget)) {
                desktopSearchResults.classList.remove('show');
              }
            }, 200);
          });

          // Prevent mousedown on results from causing blur
          desktopSearchResults.addEventListener('mousedown', function(e) {
            e.preventDefault();
          });

          // Keyboard navigation for desktop search
          desktopSearchInput.addEventListener('keydown', function(e) {
            const items = desktopSearchResults.querySelectorAll('.search-result-item');
            const activeItem = desktopSearchResults.querySelector('.search-result-item.active');
            let currentIndex = activeItem ? Array.from(items).indexOf(activeItem) : -1;

            switch(e.key) {
              case 'ArrowDown':
                e.preventDefault();
                if (items.length > 0) {
                  if (currentIndex < items.length - 1) {
                    if (activeItem) activeItem.classList.remove('active');
                    items[currentIndex + 1].classList.add('active');
                    items[currentIndex + 1].scrollIntoView({ block: 'nearest' });
                  } else if (currentIndex === -1) {
                    items[0].classList.add('active');
                    items[0].scrollIntoView({ block: 'nearest' });
                  }
                }
                break;
              case 'ArrowUp':
                e.preventDefault();
                if (items.length > 0 && currentIndex > 0) {
                  if (activeItem) activeItem.classList.remove('active');
                  items[currentIndex - 1].classList.add('active');
                  items[currentIndex - 1].scrollIntoView({ block: 'nearest' });
                }
                break;
              case 'Enter':
                e.preventDefault();
                if (activeItem) {
                  activeItem.click();
                } else if (items.length > 0) {
                  items[0].click();
                }
                break;
              case 'Escape':
                desktopSearchResults.classList.remove('show');
                this.blur();
                break;
            }
          });

          // Click outside to close search results
          document.addEventListener('click', function(e) {
            if (!desktopSearchInput.contains(e.target) && !desktopSearchResults.contains(e.target)) {
              desktopSearchResults.classList.remove('show');
            }
          });
        }

        // Active page highlighting
        function setActiveNavLink() {
          const currentPath = window.location.pathname;
          const navLinks = document.querySelectorAll(".nav-link");

          // Remove active class from all links
          navLinks.forEach((link) => link.classList.remove("active"));

          // Add active class to current page link
          navLinks.forEach((link) => {
            const linkPath = new URL(link.href).pathname;

            // Exact match for home page
            if (currentPath === "/" && linkPath === "/") {
              link.classList.add("active");
            }
            // For other pages, check if current path starts with link path
            else if (
              currentPath !== "/" &&
              linkPath !== "/" &&
              currentPath.startsWith(linkPath)
            ) {
              link.classList.add("active");
            }
            // Special cases for specific routes
            else if (
              currentPath.includes("/products") &&
              linkPath === "/shopPage"
            ) {
              link.classList.add("active");
            } else if (currentPath === "/about" && linkPath === "/about") {
              link.classList.add("active");
            } else if (currentPath === "/contact" && linkPath === "/contact") {
              link.classList.add("active");
            }
          });
        }

        // Set active link on page load
        setActiveNavLink();

        // Add smooth hover effects to icons
        const iconBtns = document.querySelectorAll(".icon-btn");
        iconBtns.forEach((btn) => {
          btn.addEventListener("mouseenter", function () {
            this.style.transform = "translateY(-3px) scale(1.05)";
          });

          btn.addEventListener("mouseleave", function () {
            this.style.transform = "translateY(0) scale(1)";
          });
        });
      });

      // Enhanced logout functionality
      document.addEventListener('DOMContentLoaded', function() {
        const logoutLinks = document.querySelectorAll('a[href="/logout"], a[href="/auth/logout"], .logout-link');

        logoutLinks.forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();

            // Show loading state
            const originalText = this.innerHTML;
            const isMobileLink = this.classList.contains('mobile-auth-link');
            if (isMobileLink) {
              this.innerHTML = '<i class="ri-loader-4-line"></i> <span>Logging out...</span>';
            } else {
              this.innerHTML = '<i class="ri-loader-4-line"></i> Logging out...';
            }
            this.style.pointerEvents = 'none';

            // Clear any local storage or session storage if used
            try {
              localStorage.removeItem('userToken');
              localStorage.removeItem('authToken');
              sessionStorage.clear();
            } catch (error) {
              console.log('Storage clear error:', error);
            }

            // Perform logout request
            fetch('/logout', {
              method: 'GET',
              credentials: 'include',
              headers: {
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
              }
            }).then(response => {
              // Force redirect regardless of response
              window.location.href = '/login';
            }).catch(error => {
              console.error('Logout error:', error);
              // Force redirect even on error
              window.location.href = '/login';
            });
          });
        });
      });
    </script>
  </body>
</html>
